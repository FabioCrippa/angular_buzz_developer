<!--
  Container principal do quiz. Utiliza uma classe para facilitar a estilização e garantir responsividade.
-->
<div class="quiz-container">
  <!-- ✅ LOADING STATE -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Carregando questões...</p>
  </div>

  <!-- ✅ ERROR STATE -->
  <div *ngIf="hasError" class="error-container">
    <div class="error-content">
      <i class="fas fa-exclamation-triangle"></i>
      <h3>Erro ao carregar questões</h3>
      <p>{{ errorMessage }}</p>
      <button class="btn btn-primary" (click)="reloadQuestions()">
        <i class="fas fa-refresh"></i>
        Tentar Novamente
      </button>
    </div>
  </div>

  <!-- ✅ QUIZ ACTIVE STATE -->
  <div *ngIf="!isLoading && !hasError && !quizCompleted && currentQuestion" class="quiz-active">
    
    <!-- ✅ HEADER -->
    <div class="quiz-header">
      <div class="quiz-info">
        <h1>{{ title }}</h1>
        <div class="question-counter">
          <span class="current">{{ currentQuestionIndex + 1 }}</span>
          <span class="separator">de</span>
          <span class="total">{{ totalQuestions }}</span>
        </div>
      </div>
      
      <!-- ✅ PROGRESS BAR -->
      <div class="progress-container">
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="progressPercentage"></div>
        </div>
        <span class="progress-text">{{ Math.round(progressPercentage) }}%</span>
      </div>
    </div>

    <!-- ✅ QUESTION CONTENT -->
    <div class="question-container">
      <div class="question-header">
        <h2 class="question-text">{{ currentQuestion.question }}</h2>
        
        <!-- ✅ QUESTION META INFO -->
        <div class="question-meta" *ngIf="currentQuestion.difficulty || currentQuestion.category">
          <span class="difficulty-tag" *ngIf="currentQuestion.difficulty">
            {{ currentQuestion.difficulty }}
          </span>
          <span class="category-tag" *ngIf="currentQuestion.category">
            {{ getCategoryTitle(currentQuestion.category) }}
          </span>
        </div>
      </div>

      <!-- ✅ OPTIONS LIST - MODO NORMAL -->
      <div class="options-container" *ngIf="!showExplanation">
        <div 
          class="option-item"
          *ngFor="let option of currentQuestion.options; let i = index"
          [class.selected]="selectedAnswer === option.alias"
          [class.disabled]="showExplanation"
          (click)="selectAnswer(option.alias)"
        >
          <div class="option-letter">{{ getOptionLetter(i) }}</div>
          <div class="option-content">
            <span class="option-text">{{ option.name }}</span>
          </div>
        </div>
      </div>

      <!-- ✅ OPTIONS LIST - MODO EXPLICAÇÃO -->
      <div class="options-container explanation-mode" *ngIf="showExplanation">
        <div 
          class="option-item"
          *ngFor="let option of currentQuestion.options; let i = index"
          [class.selected]="selectedAnswer === option.alias"
          [class.correct]="option.alias === currentQuestion.correct"
          [class.incorrect]="selectedAnswer === option.alias && option.alias !== currentQuestion.correct"
          [class.disabled]="true"
        >
          <div class="option-letter">{{ getOptionLetter(i) }}</div>
          <div class="option-content">
            <span class="option-text">{{ option.name }}</span>
            
            <!-- ✅ FEEDBACK ICONS -->
            <div class="option-feedback">
              <i class="fas fa-check-circle correct-icon" 
                 *ngIf="option.alias === currentQuestion.correct"></i>
              <i class="fas fa-times-circle incorrect-icon" 
                 *ngIf="selectedAnswer === option.alias && option.alias !== currentQuestion.correct"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- ✅ EXPLANATION SECTION -->
      <div class="explanation-container" *ngIf="showExplanation && currentQuestion.explanation">
        <div class="explanation-header">
          <i class="fas fa-lightbulb"></i>
          <h3>Explicação</h3>
        </div>
        <div class="explanation-content">
          <p>{{ currentQuestion.explanation }}</p>
          
          <!-- ✅ ADDITIONAL TIPS -->
          <div class="tips-container" *ngIf="currentQuestion.studyTip || currentQuestion.examTip || currentQuestion.interviewTip">
            <div class="tip-item" *ngIf="currentQuestion.studyTip">
              <i class="fas fa-book"></i>
              <span>{{ currentQuestion.studyTip }}</span>
            </div>
            <div class="tip-item" *ngIf="currentQuestion.examTip">
              <i class="fas fa-graduation-cap"></i>
              <span>{{ currentQuestion.examTip }}</span>
            </div>
            <div class="tip-item" *ngIf="currentQuestion.interviewTip">
              <i class="fas fa-handshake"></i>
              <span>{{ currentQuestion.interviewTip }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ✅ ACTION BUTTONS -->
    <div class="quiz-actions">
      
      <!-- ✅ SUBMIT ANSWER BUTTON -->
      <button 
        class="btn btn-primary btn-large"
        *ngIf="selectedAnswer && !showExplanation"
        (click)="submitAnswer()"
      >
        <i class="fas fa-check"></i>
        Confirmar Resposta
      </button>

      <!-- ✅ SELECT ANSWER MESSAGE -->
      <div class="select-message" *ngIf="!selectedAnswer && !showExplanation">
        <i class="fas fa-hand-pointer"></i>
        <span>Selecione uma alternativa para continuar</span>
      </div>

      <!-- ✅ NAVIGATION BUTTONS -->
      <div class="navigation-buttons" *ngIf="showExplanation">
        
        <!-- ✅ PREVIOUS BUTTON -->
        <button 
          class="btn btn-secondary"
          *ngIf="canGoPrevious"
          (click)="previousQuestion()"
        >
          <i class="fas fa-arrow-left"></i>
          Anterior
        </button>

        <!-- ✅ NEXT BUTTON -->
        <button 
          class="btn btn-primary"
          *ngIf="canGoNext"
          (click)="nextQuestion()"
        >
          Próxima
          <i class="fas fa-arrow-right"></i>
        </button>

        <!-- ✅ FINISH BUTTON -->
        <button 
          class="btn btn-success btn-large"
          *ngIf="!canGoNext"
          (click)="completeQuiz()"
        >
          <i class="fas fa-flag-checkered"></i>
          Finalizar Quiz
        </button>
      </div>
    </div>
  </div>

  <!-- ✅ QUIZ COMPLETED STATE -->
  <div *ngIf="!isLoading && !hasError && quizCompleted" class="quiz-completed">
    <div class="results-container">
      <div class="results-header">
        <i class="fas fa-trophy"></i>
        <h2>Quiz Concluído!</h2>
      </div>
      
      <div class="score-display">
        <div class="score-circle">
          <span class="score-value">{{ score }}%</span>
        </div>
        <div class="score-details">
          <p><strong>{{ correctAnswers }}</strong> de <strong>{{ totalQuestions }}</strong> questões corretas</p>
          <p>Tempo: <strong>{{ Math.floor(timeSpent / 60) }}m {{ timeSpent % 60 }}s</strong></p>
        </div>
      </div>

      <div class="results-actions">
        <button class="btn btn-primary" (click)="restartQuiz()">
          <i class="fas fa-redo"></i>
          Refazer Quiz
        </button>
        <button class="btn btn-secondary" (click)="goHome()">
          <i class="fas fa-home"></i>
          Voltar ao Início
        </button>
      </div>
    </div>
  </div>
</div>

