<!--
  Container principal do quiz. Utiliza uma classe para facilitar a estilização e garantir responsividade.
-->
<div class="quiz-container">
  <!-- ✅ HEADER DO QUIZ -->
  <div class="quiz-header">
    <div class="quiz-info">
      <div class="quiz-category">
        <img src="assets/img/logo.png" alt="logo" style="width: 60px; margin-right: 1rem;">
        <span>{{ title }}</span>
      </div>
      <div class="quiz-progress">
        Questão {{ questionIndex + 1 }} de {{ questions.length }}
      </div>
    </div>
    <div class="quiz-score">
      {{ progress }}%
    </div>
  </div>

  <!-- ✅ ÁUDIO CONTROLS -->
  <div style="text-align: center; margin-bottom: 2rem;">
    <button class="btn btn-secondary" (click)="playMusic()" style="margin-right: 1rem;">
      🎵 Tocar Música
    </button>
    <button class="btn btn-secondary" (click)="pauseMusic()">
      ⏸️ Pausar Música
    </button>
    <div id="youtube-player" style="display: none;"></div>
  </div>

  <!-- ✅ QUIZ ATIVO -->
  <div *ngIf="!finished && currentQuestion">
    <div class="question-card">
      <div class="question-number">
        {{ questionIndex + 1 }}/{{ questions.length }}
      </div>
      
      <h2 class="question-text">{{ currentQuestion.question }}</h2>
      
      <button 
        class="btn btn-secondary"
        (click)="readText(currentQuestion.question)"
        style="margin-bottom: 2rem; padding: 0.5rem 1rem; border-radius: 20px;"
      >
        🔊 Ouvir Pergunta
      </button>

      <!-- ✅ OPÇÕES COMPATÍVEIS -->
      <div class="answer-options">
        <div 
          *ngFor="let option of currentQuestion.options; let i = index" 
          class="answer-option"
          [ngClass]="{
            'selected': selectedAnswer === option.alias && !showFeedback,
            'correct': showFeedback && option.alias === currentQuestion.correct,
            'incorrect': showFeedback && selectedAnswer === option.alias && option.alias !== currentQuestion.correct,
            'disabled': showFeedback
          }"
          (click)="selectAnswer(option.alias)"
        >
          <div class="option-letter">{{ getOptionLetter(i) }}</div>
          <div class="option-text">{{ option.name }}</div>
        </div>
      </div>

      <!-- ✅ FEEDBACK -->
      <div *ngIf="showFeedback">
        <div class="explanation" *ngIf="currentQuestion.explanation">
          <div class="explanation-title">
            💡 Explicação
          </div>
          <p>{{ currentQuestion.explanation }}</p>
        </div>

        <div class="interview-tip" *ngIf="currentQuestion.interviewTip">
          <div class="interview-tip-title">
            🎯 Dica para Entrevista
          </div>
          <p>{{ currentQuestion.interviewTip }}</p>
          <button 
            class="btn btn-secondary"
            (click)="readText(currentQuestion.interviewTip)"
            style="margin-top: 1rem; padding: 0.5rem 1rem; border-radius: 20px;"
          >
            🔊 Ouvir Dica
          </button>
        </div>
      </div>

      <!-- ✅ AÇÕES -->
      <div class="quiz-actions">
        <button 
          *ngIf="!showFeedback"
          class="btn btn-secondary" 
          (click)="finishQuiz()"
        >
          ❌ Finalizar Agora
        </button>
        
        <button 
          *ngIf="showFeedback"
          class="btn btn-primary" 
          (click)="nextQuestion()"
        >
          {{ questionIndex === questions.length - 1 ? '🏁 Finalizar Quiz' : '➡️ Próxima Questão' }}
        </button>
      </div>
    </div>
  </div>

  <!-- ✅ RESULTADO FINAL -->
  <div *ngIf="finished && quizResult" class="quiz-result">
    <h2>🎉 Quiz Finalizado!</h2>
    
    <div class="result-score">{{ quizResult.percentage }}%</div>
    
    <p class="result-message">
      Você acertou {{ quizResult.score }} de {{ quizResult.total }} questões!
    </p>

    <div class="result-details">
      <div class="result-stat">
        <span class="stat-number">{{ quizResult.score }}</span>
        <span class="stat-label">Acertos</span>
      </div>
      
      <div class="result-stat">
        <span class="stat-number">{{ quizResult.total - quizResult.score }}</span>
        <span class="stat-label">Erros</span>
      </div>
      
      <div class="result-stat">
        <span class="stat-number">{{ quizResult.percentage }}%</span>
        <span class="stat-label">Desempenho</span>
      </div>
    </div>

    <!-- ✅ RESULTADOS POR CATEGORIA -->
    <div *ngIf="quizResult.categoryResults.length > 0" style="margin-top: 2rem;">
      <h3 style="margin-bottom: 1rem; color: var(--text);">📊 Por Categoria:</h3>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
        <div 
          *ngFor="let categoryResult of quizResult.categoryResults"
          style="background: var(--bg); padding: 1rem; border-radius: var(--radius); text-align: center;"
        >
          <h4 style="margin-bottom: 0.5rem; color: var(--text);">
            {{ getCategoryTitle(categoryResult.category) }}
          </h4>
          <div style="font-size: 1.2rem; font-weight: bold; color: var(--primary);">
            {{ categoryResult.percentage }}%
          </div>
          <div style="font-size: 0.9rem; opacity: 0.7; color: var(--text);">
            {{ categoryResult.correct }}/{{ categoryResult.total }}
          </div>
        </div>
      </div>
    </div>

    <!-- ✅ AÇÕES FINAIS -->
    <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem; flex-wrap: wrap;">
      <button class="btn btn-primary" (click)="restartQuiz()">
        🔄 Jogar Novamente
      </button>
      <button class="btn btn-secondary" (click)="goHome()">
        🏠 Voltar ao Início
      </button>
    </div>
  </div>

  <!-- ✅ LOADING -->
  <div *ngIf="!finished && !currentQuestion" class="quiz-loading">
    <div class="loading-spinner"></div>
    <h2>Carregando quiz...</h2>
    <p>Preparando suas questões...</p>
  </div>
</div>

