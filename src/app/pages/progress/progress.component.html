<div class="progress-container">

  <!-- ‚úÖ LOADING STATE -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner"></div>
    <h3>Carregando seu progresso...</h3>
    <p>Analisando suas estat√≠sticas</p>
  </div>

  <!-- ‚úÖ ERROR STATE -->
  <div *ngIf="hasError" class="error-container">
    <mat-icon class="error-icon">error_outline</mat-icon>
    <h2 class="error-title">Ops! Algo deu errado</h2>
    <p class="error-message">{{ errorMessage }}</p>
    <button mat-raised-button color="primary" (click)="reloadData()">
      <mat-icon>refresh</mat-icon>
      Tentar Novamente
    </button>
  </div>

  <!-- ‚úÖ MAIN CONTENT -->
  <div *ngIf="!isLoading && !hasError">

    <!-- üìä HEADER SECTION -->
    <header class="progress-header">
      <div class="header-content">
        <div class="header-text">
          <h1 class="page-title">üìà Meu Progresso</h1>
          <p class="page-subtitle">Acompanhe sua evolu√ß√£o detalhada em todas as √°reas</p>
          <p class="last-access">
            <mat-icon>schedule</mat-icon>
            √öltimo acesso: {{ formatLastAccess(progressData.lastAccess) }}
          </p>
        </div>
        <div class="header-actions">
          <button mat-stroked-button (click)="navigateToDashboard()">
            <mat-icon>dashboard</mat-icon>
            Dashboard
          </button>
          <button mat-raised-button color="primary" (click)="navigateToUpgrade()">
            <mat-icon>star</mat-icon>
            Upgrade Premium
          </button>
        </div>
      </div>
    </header>

    <!-- üèÜ OVERALL STATS -->
    <section class="overall-stats-section">
      <h2 class="section-title">Estat√≠sticas Gerais</h2>
      
      <div class="stats-grid">
        <div class="stat-card total-card">
          <div class="stat-icon">
            <mat-icon>quiz</mat-icon>
          </div>
          <div class="stat-content">
            <span class="stat-number">{{ progressData.overallStats.totalCompleted }}</span>
            <span class="stat-label">Quest√µes Respondidas</span>
            <span class="stat-sublabel">no total</span>
          </div>
        </div>

        <div class="stat-card accuracy-card">
          <div class="stat-icon">
            <mat-icon>trending_up</mat-icon>
          </div>
          <div class="stat-content">
            <span class="stat-number">{{ progressData.overallStats.averageAccuracy }}%</span>
            <span class="stat-label">Precis√£o M√©dia</span>
            <span class="stat-sublabel">em {{ progressData.areasProgress.length }} √°rea(s) estudada(s)</span>
          </div>
        </div>

        <div class="stat-card time-card">
          <div class="stat-icon">
            <mat-icon>schedule</mat-icon>
          </div>
          <div class="stat-content">
            <span class="stat-number">{{ progressData.overallStats.totalTimeSpent }}</span>
            <span class="stat-label">Tempo Total</span>
            <span class="stat-sublabel">estudando</span>
          </div>
        </div>

        <div class="stat-card streak-card">
          <div class="stat-icon">
            <mat-icon>local_fire_department</mat-icon>
          </div>
          <div class="stat-content">
            <span class="stat-number">{{ progressData.overallStats.streak }}</span>
            <span class="stat-label">Sequ√™ncia</span>
            <span class="stat-sublabel">dia(s) consecutivo(s)</span>
          </div>
        </div>
      </div>
    </section>

    <!-- üîß FILTERS & SORTING -->
    <section class="filters-section">
      <div class="filters-content">
        <div class="filters-group">
          <h3>Filtrar por:</h3>
          <div class="filter-buttons">
            <button 
              mat-stroked-button 
              [color]="filterBy === 'all' ? 'primary' : ''"
              (click)="setFilterBy('all')"
            >
              Todas ({{ progressData.areasProgress.length }})
            </button>
            <button 
              mat-stroked-button 
              [color]="filterBy === 'completed' ? 'primary' : ''"
              (click)="setFilterBy('completed')"
            >
              Conclu√≠das
            </button>
            <button 
              mat-stroked-button 
              [color]="filterBy === 'inProgress' ? 'primary' : ''"
              (click)="setFilterBy('inProgress')"
            >
              Em Progresso
            </button>
            <button 
              mat-stroked-button 
              [color]="filterBy === 'notStarted' ? 'primary' : ''"
              (click)="setFilterBy('notStarted')"
            >
              N√£o Iniciadas
            </button>
          </div>
        </div>

        <div class="sort-group">
          <h3>Ordenar por:</h3>
          <mat-select [(value)]="sortBy" (selectionChange)="setSortBy($event.value)">
            <mat-option value="progress">Progresso</mat-option>
            <mat-option value="accuracy">Precis√£o</mat-option>
            <mat-option value="name">Nome</mat-option>
          </mat-select>
        </div>
      </div>
    </section>

    <!-- üìö AREAS PROGRESS -->
    <section class="areas-progress-section">
      <h2 class="section-title">Progresso por √Årea</h2>
      
      <div class="areas-grid">
        <div 
          *ngFor="let area of filteredAndSortedAreas; trackBy: trackAreaProgress" 
          class="area-progress-card"
          [class.completed]="area.progress >= 100"
          (click)="startQuizForArea(area.name)"
        >
          
          <!-- üéØ AREA HEADER -->
          <div class="area-header">
            <div class="area-icon">{{ area.icon }}</div>
            <div class="area-info">
              <h3 class="area-name">{{ area.displayName }}</h3>
              <p class="area-difficulty">
                <mat-icon>bar_chart</mat-icon>
                Dificuldade: {{ area.difficulty }}
              </p>
            </div>
            <div class="area-badge" [class]="'progress-' + getProgressLevel(area.progress)">
              {{ area.progress }}%
            </div>
          </div>

          <!-- üìä PROGRESS BAR -->
          <div class="progress-bar-container">
            <div class="progress-stats-inline">
              <div class="stat-inline">
                <mat-icon>check_circle</mat-icon>
                <span class="stat-value">{{ area.completed }}</span>
                <span class="stat-label">respondidas</span>
              </div>
              <div class="stat-inline">
                <mat-icon>target</mat-icon>
                <span class="stat-value" [style.color]="getAccuracyColor(area.accuracy)">{{ area.accuracy }}%</span>
                <span class="stat-label">acerto</span>
              </div>
            </div>
          </div>

          <!-- üìà AREA STATS -->
          <div class="area-stats">
            <div class="stat-item">
              <mat-icon>target</mat-icon>
              <span class="stat-value" [style.color]="getAccuracyColor(area.accuracy)">
                {{ area.accuracy }}%
              </span>
              <span class="stat-label">Precis√£o</span>
            </div>
            
            <div class="stat-item">
              <mat-icon>schedule</mat-icon>
              <span class="stat-value">{{ area.timeSpent }}</span>
              <span class="stat-label">Tempo</span>
            </div>
            
            <div class="stat-item">
              <mat-icon>event</mat-icon>
              <span class="stat-value">{{ area.lastActivity }}</span>
              <span class="stat-label">√öltimo</span>
            </div>
          </div>

          <!-- üéØ AREA ACTIONS -->
          <div class="area-actions">
            <!-- Bot√£o principal: Quiz direto -->
            <button 
              class="btn btn-primary" 
              (click)="startQuizForArea(area.name); $event.stopPropagation()"
            >
              <span class="btn-icon">‚ñ∂Ô∏è</span>
              <span class="btn-text">{{ area.progress === 0 ? 'Come√ßar Quiz' : 'Continuar Quiz' }}</span>
              <span class="btn-shine"></span>
            </button>
            
            <!-- Bot√£o secund√°rio: Explorar √°rea -->
            <button 
              class="btn btn-secondary"
              (click)="navigateToArea(area.name); $event.stopPropagation()"
            >
              <span class="btn-icon">üîç</span>
              <span class="btn-text">Explorar</span>
              <span class="btn-shine"></span>
            </button>
          </div>

          <!-- ‚ú® COMPLETION BADGE -->
          <div *ngIf="area.progress >= 100" class="completion-badge">
            <mat-icon>check_circle</mat-icon>
            <span>Conclu√≠da!</span>
          </div>

        </div>
      </div>

      <!-- üìã EMPTY STATE -->
      <div *ngIf="filteredAndSortedAreas.length === 0" class="empty-state">
        <mat-icon>search_off</mat-icon>
        <h3>Nenhuma √°rea encontrada</h3>
        <p>Tente ajustar os filtros ou come√ßar estudando uma nova √°rea</p>
        <button mat-raised-button color="primary" (click)="navigateToDashboard()">
          Voltar ao Dashboard
        </button>
      </div>
    </section>

    <!-- üéØ RECOMMENDATIONS -->
    <section class="recommendations-section">
      <h2 class="section-title">Recomenda√ß√µes</h2>
      
      <div class="recommendations-grid">
        <div class="recommendation-card study-card">
          <mat-icon class="rec-icon">school</mat-icon>
          <h3>Continue Estudando</h3>
          <p>Voc√™ tem {{ getInProgressAreasCount() }} √°rea(s) em progresso. Continue praticando!</p>
          <button mat-stroked-button (click)="startQuizForArea(getNextAreaToStudy())">
            Pr√≥xima √Årea
          </button>
        </div>

        <div class="recommendation-card upgrade-card">
          <mat-icon class="rec-icon">star</mat-icon>
          <h3>Upgrade Premium</h3>
          <p>Acesse relat√≥rios detalhados e simulados personalizados</p>
          <button mat-raised-button color="primary" (click)="navigateToUpgrade()">
            Fazer Upgrade
          </button>
        </div>

        <div class="recommendation-card streak-card">
          <mat-icon class="rec-icon">local_fire_department</mat-icon>
          <h3>Manter Sequ√™ncia</h3>
          <p>Voc√™ est√° h√° {{ progressData.overallStats.streak }} dia(s) estudando!</p>
          <button mat-stroked-button (click)="navigateToDashboard()">
            Estudar Hoje
          </button>
        </div>
      </div>
    </section>

    <!-- üÜï NEW AREAS SECTION - VERS√ÉO CORRIGIDA -->
    <section class="new-areas-section" *ngIf="getAvailableAreasToStart().length > 0">
      <h2 class="section-title">Come√ßar Nova √Årea</h2>
      
      <div class="new-areas-grid">
        <div 
          *ngFor="let area of getAvailableAreasToStart()" 
          class="new-area-card"
        >
          <!-- ‚úÖ CONTE√öDO PRINCIPAL -->
          <div class="new-area-content">
            <div class="new-area-icon">{{ area.icon }}</div>
            <h3>{{ area.displayName }}</h3>
            <p class="area-description">{{ area.description }}</p>
            <div class="area-meta">
              <span class="question-count">
                <mat-icon>quiz</mat-icon>
                {{ area.questionCount }} quest√µes
              </span>
              <span class="difficulty" [class]="'difficulty-' + area.difficulty.toLowerCase()">
                <mat-icon>bar_chart</mat-icon>
                {{ area.difficulty }}
              </span>
            </div>
          </div>
          
          <!-- ‚úÖ A√á√ïES SEMPRE NO FINAL -->
          <div class="new-area-actions">
            <button 
              mat-raised-button 
              color="primary"
              (click)="startQuizForArea(area.name)"
            >
              <mat-icon>play_arrow</mat-icon>
              Come√ßar
            </button>
          </div>
        </div>
      </div>
    </section>

  </div>
</div>
