<!-- Area Content -->
<div *ngIf="!isLoading && !hasError && areaData" class="area-container">

  <!-- ‚úÖ LOADING STATE -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner"></div>
    <h3>Carregando √°rea de estudo...</h3>
    <p>Preparando quest√µes e conte√∫do</p>
  </div>

  <!-- ‚úÖ ERROR STATE -->
  <div *ngIf="hasError" class="error-container">
    <mat-icon class="error-icon">error_outline</mat-icon>
    <h2 class="error-title">√Årea n√£o encontrada</h2>
    <p class="error-message">{{ errorMessage }}</p>
    <div class="error-actions">
      <button mat-stroked-button (click)="navigateToDashboard()">
        <mat-icon>dashboard</mat-icon>
        Voltar ao Dashboard
      </button>
      <button mat-raised-button color="primary" (click)="reloadData()">
        <mat-icon>refresh</mat-icon>
        Tentar Novamente
      </button>
    </div>
  </div>

  <!-- ‚úÖ MAIN CONTENT -->
  <div *ngIf="!isLoading && !hasError && areaData">

    <!-- üìö BREADCRUMB -->
    <div class="breadcrumb">
      <button mat-button (click)="navigateToDashboard()" class="breadcrumb-item">
        <mat-icon>home</mat-icon>
        Dashboard
      </button>
      <mat-icon class="breadcrumb-separator">chevron_right</mat-icon>
      <span class="breadcrumb-current">{{ areaData.displayName }}</span>
    </div>

    <!-- üéØ AREA HEADER -->
    <header class="area-header" [style.background]="'linear-gradient(135deg, ' + areaData.color + ', ' + areaData.color + '80)'">
      <div class="header-content">
        <div class="header-main">
          <div class="area-icon-large">{{ areaData.icon }}</div>
          <div class="area-info">
            <h1 class="area-title">{{ areaData.displayName }}</h1>
            <p class="area-description">{{ areaData.description }}</p>
            <div class="area-meta">
              <span class="meta-item">
                <mat-icon>quiz</mat-icon>
                {{ areaData.totalQuestions }} quest√µes
              </span>
              <span class="meta-item">
                <mat-icon>category</mat-icon>
                {{ areaData.subjects.length }} assuntos
              </span>
            </div>
          </div>
        </div>
        <div class="header-actions">
          <button mat-stroked-button (click)="navigateToFavorites()">
            <mat-icon>favorite</mat-icon>
            Favoritos
          </button>
          <button mat-raised-button color="primary" (click)="startAreaQuiz()">
            <mat-icon>play_arrow</mat-icon>
            Quiz da √Årea
          </button>
        </div>
      </div>
    </header>

    <!-- üìä USER PROGRESS -->
    <section class="progress-section">
      <h2 class="section-title">Seu Progresso</h2>
      
      <div class="progress-grid">
        <div class="progress-card completed-card">
          <div class="progress-icon">
            <mat-icon>check_circle</mat-icon>
          </div>
          <div class="progress-content">
            <span class="progress-number">{{ areaData.userProgress.completed }}</span>
            <span class="progress-label">Quest√µes Resolvidas</span>
            <span class="progress-sublabel">de {{ areaData.totalQuestions }}</span>
          </div>
        </div>

        <div class="progress-card accuracy-card">
          <div class="progress-icon">
            <mat-icon>trending_up</mat-icon>
          </div>
          <div class="progress-content">
            <span class="progress-number">{{ areaData.userProgress.accuracy }}%</span>
            <span class="progress-label">Taxa de Acerto</span>
            <span class="progress-sublabel">m√©dia geral</span>
          </div>
        </div>

        <div class="progress-card time-card">
          <div class="progress-icon">
            <mat-icon>schedule</mat-icon>
          </div>
          <div class="progress-content">
            <span class="progress-number">{{ areaData.userProgress.timeSpent }}</span>
            <span class="progress-label">Tempo de Estudo</span>
            <span class="progress-sublabel">total investido</span>
          </div>
        </div>

        <div class="progress-card level-card">
          <div class="progress-icon">
            <mat-icon>emoji_events</mat-icon>
          </div>
          <div class="progress-content">
            <span class="progress-number">{{ getProgressPercentage() }}%</span>
            <span class="progress-label">Completude</span>
            <span class="progress-sublabel">da √°rea</span>
          </div>
        </div>
      </div>

      <!-- Progress Bar Visual -->
      <div class="overall-progress">
        <div class="progress-bar-container">
          <div class="progress-bar">
            <div 
              class="progress-fill" 
              [style.width.%]="getProgressPercentage()"
              [style.background-color]="areaData.color"
            ></div>
          </div>
          <span class="progress-text">
            {{ areaData.userProgress.completed }}/{{ areaData.totalQuestions }} quest√µes completadas
          </span>
        </div>
      </div>
    </section>

    <!-- üîç FILTERS & SEARCH -->
    <section class="filters-section">
      <div class="filters-header">
        <h2 class="section-title">Explorar Quest√µes</h2>
        <div class="results-count">
          <span class="count-badge">{{ filteredQuestions.length }} quest√µes encontradas</span>
        </div>
      </div>

      <div class="filters-content">
        <!-- Search Bar -->
        <div class="search-group">
          <mat-icon class="search-icon">search</mat-icon>
          <input 
            type="text" 
            placeholder="Buscar quest√µes, assuntos, tags..." 
            [(ngModel)]="searchQuery"
            class="search-input"
          >
        </div>

        <!-- Filter Controls -->
        <div class="filter-controls">
          <div class="filter-group">
            <label class="filter-label">Assunto:</label>
            <mat-select [(value)]="selectedSubject" class="filter-select">
              <mat-option value="all">Todos os Assuntos</mat-option>
              <mat-option *ngFor="let subject of areaData.subjects" [value]="subject">
                {{ subject }}
              </mat-option>
            </mat-select>
          </div>

          <div class="filter-group">
            <label class="filter-label">Dificuldade:</label>
            <mat-select [(value)]="selectedDifficulty" class="filter-select">
              <mat-option value="all">Todas</mat-option>
              <mat-option value="F√°cil">F√°cil ({{ areaData.difficulty.easy }})</mat-option>
              <mat-option value="M√©dio">M√©dio ({{ areaData.difficulty.medium }})</mat-option>
              <mat-option value="Dif√≠cil">Dif√≠cil ({{ areaData.difficulty.hard }})</mat-option>
            </mat-select>
          </div>

          <div class="filter-group">
            <label class="filter-label">Ordenar por:</label>
            <mat-select [(value)]="sortBy" class="filter-select">
              <mat-option value="popularity">Mais Populares</mat-option>
              <mat-option value="difficulty">Por Dificuldade</mat-option>
              <mat-option value="subject">Por Assunto</mat-option>
              <mat-option value="recent">Mais Recentes</mat-option>
            </mat-select>
          </div>

          <button mat-icon-button matTooltip="Limpar filtros" (click)="clearFilters()">
            <mat-icon>clear</mat-icon>
          </button>
        </div>

        <!-- Quick Filter Buttons -->
        <div class="quick-filters">
          <button 
            mat-stroked-button 
            [color]="selectedDifficulty === 'F√°cil' ? 'primary' : ''"
            (click)="selectedDifficulty = selectedDifficulty === 'F√°cil' ? 'all' : 'F√°cil'"
          >
            <mat-icon>trending_down</mat-icon>
            F√°cil
          </button>
          <button 
            mat-stroked-button 
            [color]="selectedDifficulty === 'M√©dio' ? 'primary' : ''"
            (click)="selectedDifficulty = selectedDifficulty === 'M√©dio' ? 'all' : 'M√©dio'"
          >
            <mat-icon>trending_flat</mat-icon>
            M√©dio
          </button>
          <button 
            mat-stroked-button 
            [color]="selectedDifficulty === 'Dif√≠cil' ? 'primary' : ''"
            (click)="selectedDifficulty = selectedDifficulty === 'Dif√≠cil' ? 'all' : 'Dif√≠cil'"
          >
            <mat-icon>trending_up</mat-icon>
            Dif√≠cil
          </button>
          <button 
            mat-stroked-button 
            (click)="startCustomQuiz()"
            [disabled]="filteredQuestions.length === 0"
            class="custom-quiz-btn"
          >
            <mat-icon>play_arrow</mat-icon>
            Quiz Personalizado
          </button>
        </div>
      </div>
    </section>

    <!-- üìù QUESTIONS GRID -->
    <section class="questions-section">
      <div class="questions-grid">
        <div 
          *ngFor="let question of paginatedQuestions; trackBy: trackQuestion" 
          class="question-card"
          [class.favorite]="question.isFavorite"
        >
          
          <!-- Question Header -->
          <div class="question-header">
            <div class="question-meta">
              <span class="subject-tag" [style.background-color]="areaData.color + '20'" [style.color]="areaData.color">
                {{ question.subject }}
              </span>
              <span class="difficulty-badge" [style.color]="getDifficultyColor(question.difficulty)">
                <mat-icon>{{ getDifficultyIcon(question.difficulty) }}</mat-icon>
                {{ question.difficulty }}
              </span>
            </div>
            <div class="question-actions">
              <button 
                mat-icon-button 
                matTooltip="Adicionar/Remover favorito"
                (click)="toggleFavorite(question.id)"
                [class.favorited]="question.isFavorite"
              >
                <mat-icon>{{ question.isFavorite ? 'favorite' : 'favorite_border' }}</mat-icon>
              </button>
            </div>
          </div>

          <!-- Question Content -->
          <div class="question-content">
            <h3 class="question-text">{{ question.question }}</h3>
            
            <div class="question-details">
              <div class="question-tags" *ngIf="question.tags.length > 0">
                <mat-icon>label</mat-icon>
                <span *ngFor="let tag of question.tags.slice(0, 3)" class="tag">{{ tag }}</span>
                <span *ngIf="question.tags.length > 3" class="more-tags">+{{ question.tags.length - 3 }}</span>
              </div>
              
              <div class="question-stats">
                <span class="stat-item">
                  <mat-icon>schedule</mat-icon>
                  {{ question.estimatedTime }}
                </span>
                <span class="stat-item">
                  <mat-icon>trending_up</mat-icon>
                  {{ question.popularity }}% popularidade
                </span>
              </div>
            </div>
          </div>

          <!-- Question Actions -->
          <div class="question-card-actions">
            <button 
              mat-stroked-button 
              (click)="viewQuestion(question)"
              class="view-btn"
            >
              <mat-icon>visibility</mat-icon>
              Visualizar
            </button>
            
            <button 
              mat-raised-button 
              [style.background-color]="areaData.color"
              style="color: white"
              (click)="startSingleQuestionQuiz(question)"
            >
              <mat-icon>play_arrow</mat-icon>
              Responder
            </button>
          </div>

          <!-- Favorite Indicator -->
          <div *ngIf="question.isFavorite" class="favorite-indicator">
            <mat-icon>favorite</mat-icon>
          </div>

        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="filteredQuestions.length === 0" class="empty-state">
        <mat-icon>search_off</mat-icon>
        <h3>Nenhuma quest√£o encontrada</h3>
        <p>Tente ajustar os filtros ou termo de busca</p>
        <button mat-raised-button color="primary" (click)="clearFilters()">
          <mat-icon>clear</mat-icon>
          Limpar Filtros
        </button>
      </div>
    </section>

    <!-- üìÑ PAGINATION -->
    <section class="pagination-section" *ngIf="totalPages > 1">
      <div class="pagination-info">
        <span>
          P√°gina {{ currentPage }} de {{ totalPages }} 
          ({{ filteredQuestions.length }} quest√µes)
        </span>
      </div>
      
      <div class="pagination-controls">
        <button 
          mat-icon-button 
          [disabled]="currentPage === 1"
          (click)="changePage(currentPage - 1)"
          matTooltip="P√°gina anterior"
        >
          <mat-icon>chevron_left</mat-icon>
        </button>
        
        <div class="page-numbers">
          <button 
            *ngFor="let page of getPageNumbers()" 
            mat-button
            [color]="page === currentPage ? 'primary' : ''"
            (click)="changePage(page)"
            [disabled]="page === currentPage"
          >
            {{ page }}
          </button>
        </div>
        
        <button 
          mat-icon-button 
          [disabled]="currentPage === totalPages"
          (click)="changePage(currentPage + 1)"
          matTooltip="Pr√≥xima p√°gina"
        >
          <mat-icon>chevron_right</mat-icon>
        </button>
      </div>
    </section>

    <!-- üéØ QUICK ACTIONS -->
    <section class="quick-actions-section">
      <h2 class="section-title">A√ß√µes R√°pidas</h2>
      
      <div class="quick-actions-grid">
        <div class="quick-action-card" (click)="startAreaQuiz()">
          <mat-icon class="action-icon">quiz</mat-icon>
          <h3>Quiz Completo</h3>
          <p>10 quest√µes aleat√≥rias desta √°rea</p>
          <button mat-stroked-button>Iniciar</button>
        </div>

        <div class="quick-action-card" (click)="startCustomQuiz()">
          <mat-icon class="action-icon">tune</mat-icon>
          <h3>Quiz Personalizado</h3>
          <p>Com base nos filtros aplicados</p>
          <button mat-stroked-button [disabled]="filteredQuestions.length === 0">
            Configurar
          </button>
        </div>

        <div class="quick-action-card" (click)="navigateToFavorites()">
          <mat-icon class="action-icon">favorite</mat-icon>
          <h3>Favoritos</h3>
          <p>Suas quest√µes marcadas como favoritas</p>
          <button mat-stroked-button>Ver Favoritos</button>
        </div>

        <div class="quick-action-card" (click)="navigateToDashboard()">
          <mat-icon class="action-icon">dashboard</mat-icon>
          <h3>Dashboard</h3>
          <p>Voltar √† vis√£o geral</p>
          <button mat-stroked-button>Dashboard</button>
        </div>
      </div>
    </section>

  </div>
</div>
