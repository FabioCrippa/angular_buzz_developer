<!--
  Container principal do quiz. Utiliza uma classe para facilitar a estiliza√ß√£o e garantir responsividade.
-->
<div class="quiz-container">
  <!-- ‚úÖ LOADING STATE -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Carregando quest√µes...</p>
  </div>

  <!-- ‚úÖ ERROR STATE -->
  <div *ngIf="hasError" class="error-container">
    <div class="error-content">
      <i class="fas fa-exclamation-triangle"></i>
      <h3>Erro ao carregar quest√µes</h3>
      <p>{{ errorMessage }}</p>
      <button class="btn btn-primary" (click)="reloadQuestions()">
        <i class="fas fa-refresh"></i>
        Tentar Novamente
      </button>
    </div>
  </div>

  <!-- ‚úÖ QUIZ ACTIVE STATE -->
  <div *ngIf="!isLoading && !hasError && !quizCompleted && currentQuestion" class="quiz-active">
    
    <!-- ‚úÖ HEADER -->
    <div class="quiz-header">
      <div class="quiz-info">
        <h1>{{ title }}</h1>
        <div class="question-counter">
          <span class="current">{{ currentQuestionIndex + 1 }}</span>
          <span class="separator">de</span>
          <span class="total">{{ totalQuestions }}</span>
        </div>
      </div>
      
      <!-- ‚úÖ PROGRESS BAR -->
      <div class="progress-container">
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="progressPercentage"></div>
        </div>
        <span class="progress-text">{{ Math.round(progressPercentage) }}%</span>
      </div>
    </div>

    <!-- üìä Stats Header -->
    <div class="quiz-stats" *ngIf="!isLoading && !hasError">
      <div class="stat-item">
        <div class="stat-value">{{ currentQuestionIndex + 1 }}</div>
        <div class="stat-label">Quest√£o</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">{{ correctAnswers }}</div>
        <div class="stat-label">Acertos</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">{{ getTimeSpentFormatted() }}</div>
        <div class="stat-label">Tempo</div>
      </div>
      <div class="stat-item">
        <button mat-icon-button (click)="toggleFavorite()" 
                [color]="isFavorite() ? 'accent' : ''" 
                title="Favoritar quest√£o">
          <mat-icon>{{ isFavorite() ? 'favorite' : 'favorite_border' }}</mat-icon>
        </button>
      </div>
      <div class="stat-item">
        <button mat-icon-button (click)="pauseQuiz()" 
                [title]="isPaused ? 'Continuar' : 'Pausar'">
          <mat-icon>{{ isPaused ? 'play_arrow' : 'pause' }}</mat-icon>
        </button>
      </div>
    </div>

    <!-- Pause Overlay -->
    <div class="pause-overlay" *ngIf="isPaused">
      <div class="pause-card">
        <mat-icon style="font-size: 3rem; color: #667eea;">pause_circle_filled</mat-icon>
        <h2>Quiz Pausado</h2>
        <p>Clique em continuar quando estiver pronto</p>
        <button mat-raised-button color="primary" (click)="pauseQuiz()">
          <mat-icon>play_arrow</mat-icon>
          Continuar
        </button>
      </div>
    </div>

    <!-- ‚úÖ QUESTION CONTENT -->
    <div class="question-container">
      <div class="question-header">
        <h2 class="question-text">{{ currentQuestion.question }}</h2>
        
        <!-- ‚úÖ QUESTION META INFO -->
        <div class="question-meta" *ngIf="currentQuestion.difficulty || currentQuestion.category">
          <span class="difficulty-tag" *ngIf="currentQuestion.difficulty">
            {{ currentQuestion.difficulty }}
          </span>
          <span class="category-tag" *ngIf="currentQuestion.category">
            {{ getCategoryTitle(currentQuestion.category) }}
          </span>
        </div>
      </div>

      <!-- ‚úÖ OPTIONS LIST - MODO NORMAL -->
      <div class="options-container" *ngIf="!showExplanation">
        <div 
          class="option-item"
          *ngFor="let option of currentQuestion.options; let i = index"
          [class.selected]="selectedAnswer === option.alias"
          [class.disabled]="showExplanation"
          (click)="selectAnswer(option.alias)"
        >
          <div class="option-letter">{{ getOptionLetter(i) }}</div>
          <div class="option-content">
            <span class="option-text">{{ option.name }}</span>
          </div>
        </div>
      </div>

      <!-- ‚úÖ OPTIONS LIST - MODO EXPLICA√á√ÉO -->
      <div class="options-container explanation-mode" *ngIf="showExplanation">
        <div 
          class="option-item"
          *ngFor="let option of currentQuestion.options; let i = index"
          [class.selected]="selectedAnswer === option.alias"
          [class.correct]="option.alias === currentQuestion.correct"
          [class.incorrect]="selectedAnswer === option.alias && option.alias !== currentQuestion.correct"
          [class.disabled]="true"
        >
          <div class="option-letter">{{ getOptionLetter(i) }}</div>
          <div class="option-content">
            <span class="option-text">{{ option.name }}</span>
            
            <!-- ‚úÖ FEEDBACK ICONS -->
            <div class="option-feedback">
              <i class="fas fa-check-circle correct-icon" 
                 *ngIf="option.alias === currentQuestion.correct"></i>
              <i class="fas fa-times-circle incorrect-icon" 
                 *ngIf="selectedAnswer === option.alias && option.alias !== currentQuestion.correct"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- ‚úÖ EXPLANATION SECTION -->
      <div class="explanation-container" *ngIf="showExplanation && currentQuestion.explanation">
        <div class="explanation-header">
          <i class="fas fa-lightbulb"></i>
          <h3>Explica√ß√£o</h3>
        </div>
        <div class="explanation-content">
          <p>{{ currentQuestion.explanation }}</p>
          
          <!-- ‚úÖ ADDITIONAL TIPS -->
          <div class="tips-container" *ngIf="currentQuestion.studyTip || currentQuestion.examTip || currentQuestion.interviewTip">
            <div class="tip-item" *ngIf="currentQuestion.studyTip">
              <i class="fas fa-book"></i>
              <span>{{ currentQuestion.studyTip }}</span>
            </div>
            <div class="tip-item" *ngIf="currentQuestion.examTip">
              <i class="fas fa-graduation-cap"></i>
              <span>{{ currentQuestion.examTip }}</span>
            </div>
            <div class="tip-item" *ngIf="currentQuestion.interviewTip">
              <i class="fas fa-handshake"></i>
              <span>{{ currentQuestion.interviewTip }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ‚úÖ ACTION BUTTONS -->
    <div class="quiz-actions">
      
      <!-- ‚úÖ SUBMIT ANSWER BUTTON -->
      <button 
        class="btn btn-primary btn-large"
        *ngIf="selectedAnswer && !showExplanation"
        (click)="submitAnswer()"
      >
        <i class="fas fa-check"></i>
        Confirmar Resposta
      </button>

      <!-- ‚úÖ SELECT ANSWER MESSAGE -->
      <div class="select-message" *ngIf="!selectedAnswer && !showExplanation">
        <span>Selecione uma alternativa para continuar</span>
      </div>

      <!-- ‚úÖ NAVIGATION BUTTONS -->
      <div class="navigation-buttons" *ngIf="showExplanation">
        
        <!-- ‚úÖ PREVIOUS BUTTON -->
        <button 
          class="btn btn-secondary"
          *ngIf="canGoPrevious"
          (click)="previousQuestion()"
        >
          <i class="fas fa-arrow-left"></i>
          Anterior
        </button>

        <!-- ‚úÖ NEXT BUTTON -->
        <button 
          class="btn btn-primary"
          *ngIf="canGoNext"
          (click)="nextQuestion()"
        >
          Pr√≥xima
          <i class="fas fa-arrow-right"></i>
        </button>

        <!-- ‚úÖ FINISH BUTTON -->
        <button 
          class="btn btn-success btn-large"
          *ngIf="!canGoNext"
          (click)="completeQuiz()"
        >
          <i class="fas fa-flag-checkered"></i>
          Finalizar Quiz
        </button>
      </div>
    </div>
  </div>

  <!-- ‚úÖ QUIZ COMPLETED STATE -->
  <div *ngIf="!isLoading && !hasError && quizCompleted" class="quiz-completed">
    <div class="results-container">
      <div class="results-header">
        <i class="fas fa-trophy"></i>
        <h2>Quiz Conclu√≠do!</h2>
      </div>
      
      <div class="score-display">
        <div class="score-circle">
          <span class="score-value">{{ score }}%</span>
        </div>
        <div class="score-details">
          <p><strong>{{ correctAnswers }}</strong> de <strong>{{ totalQuestions }}</strong> quest√µes corretas</p>
          <p>Tempo: <strong>{{ Math.floor(timeSpent / 60) }}m {{ timeSpent % 60 }}s</strong></p>
        </div>
      </div>

      <div class="results-actions">
        <button class="btn btn-primary" (click)="restartQuiz()">
          <i class="fas fa-redo"></i>
          Refazer Quiz
        </button>
        <button class="btn btn-secondary" (click)="goHome()">
          <i class="fas fa-home"></i>
          Voltar ao In√≠cio
        </button>
      </div>
    </div>
  </div>
</div>

